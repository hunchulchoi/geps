<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´" />
        <meta name="author" content="ê³µë¬´ì› ì—°ê¸ˆê³µë‹¨" />
        <title>ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´</title>
        <meta property="og:title" content="ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´" />
        <meta property="og:description" content="Simple chatbox widget using Twitter Bootstrap 5" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://sistematico.github.io/bootstrap-chatbox" />
        <meta property="og:image" content="https://sistematico.github.io/bootstrap-chatbox/assets/img/logo-purple.png" />
        <link rel="icon" type="image/svg+xml" href="assets/img/logo-purple.svg" />
        <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
        <link rel="stylesheet" href="assets/css/main.css" />
    </head>
    <body>
        <header>
            <div class="container d-flex align-items-center justify-content-between p-3 mb-3 custom-border-bottom">
                <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
                    <img class="logo" src="assets/img/logo.png" alt="ê³µë¬´ì› ì—°ê¸ˆê³µë‹¨" height="40" style="margin-top: 8px" />
                    <span class="ms-2 fs-4">ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´ í”„ë¡œê·¸ë¨</span>
                </a>

                <div>
                    <button class="btn btn-warning" onclick="chatStart()">ì²˜ìŒë¶€í„°</button>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <div class="modal fade" tabindex="-1" id="modal">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><img class="logo" src="assets/img/logo.png" alt="ê³µë¬´ì› ì—°ê¸ˆê³µë‹¨" height="40" />ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´ í”„ë¡œê·¸ë¨</h5>
                                <button class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-5"><img src="assets/img/geps_mascot.png" alt="ë¯¿ìŒì´ì™€ ë™í–‰ì´" width="100%" /></div>
                                    <div class="col-7">
                                        <p>ê¸°ì¡´ì˜ ìˆ˜ë™ì ì—ì„œ ë³´ë‹¤ ëŠ¥ë™ì ì´ê³  ê³ ê° ìƒí™©ë³„ ëŒ€ì‘ ì‚¬ë¡€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ ê³µë‹¨ì˜ ì—°ê¸ˆì „ë¬¸ì„±ì„ í†µí•´ ê³ ê°ë‹˜ë“¤ê»˜ ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´ í”„ë¡œê·¸ë¨ì„ ì œì‘í–ˆìŠµë‹ˆë‹¤.</p>
                                        <p>í‡´ì§ì‚¬ìœ ì™€ ê¸‰ì—¬ì¢…ë¥˜ ë“± í–¥í›„ ê²½ë ¥ê²½ë¡œ ë“±</p>
                                        <p>ì—¬ëŸ¬ë¶„ì˜ í˜„ì¬(ë‹¨ê¸° ì˜ˆì •)ì™€ ë¯¸ë˜ ìƒí™©ì í•©í•œ ê³µì ì—°ê¸ˆ ë¶„ì–‘ì— ì „ë¬¸ì ì¸ ì•ˆë‚´ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì¶©ë¶„í•œ ì—°ê¸ˆì œë„ í™œìš©ê³¼ ë…¸í›„ ì„¤ê³„ë¥¼ ì§€ì›í•˜ê³ ì ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p>
                                        <p>ê³ ê°ë‹˜ê»˜ì„œ ì…ë ¥í•˜ì‹  ê°’ì— ë”°ë¼ ê³µë‹¨ ë§ˆìŠ¤ì½”íŠ¸ ë¯¿ìŒì´ê°€ ì•ˆë‚´ë¥¼ ë„ì™€ ë“œë¦½ë‹ˆë‹¤.</p>
                                        <p>ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                                    </div>
                                </div>
                                <p class="fs-4 text-warning">ğŸ™…ğŸ»â€â™€ï¸ ë³¸ ê°œì¸ë³„ ì…ë µê°’ ë“± ì •ë³´ëŠ” ìˆ˜ì§‘, ë³´ê´€ë˜ì§€ ì•Šìœ¼ë©°, ì„œë¹„ìŠ¤ ì¢…ë£Œí›„ ìë™ì ìœ¼ë¡œ íê¸°ë©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="modal-footer">'<button class="btn btn-md btn-primary w-25" data-bs-dismiss="modal">ë‹«ê¸°</button></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="z-index: 1030">
                        <h5>ëŒ€í™”í•˜ê¸°</h5>
                    </div>
                    <div class="card-body" id="messages"></div>
                </div>
            </div>
        </main>
        <footer class="py-3">
            <div class="container custom-border-top pt-3" style="color: #556677">
                (63568)ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì„œê·€í¬ì‹œ ì„œí˜¸ì¤‘ì•™ë¡œ 63(ì„œí˜¸ë™)<br />
                Copyright(c) GEPS. All Right Reserved.
            </div>
        </footer>
        <script src="assets/js/bootstrap.bundle.min.js"></script>
        <script src="assets/js/moment-with-locales.min.js"></script>
        <script src="assets/js/info1.json"></script>
        <script>
            //[...Array(10)].forEach((e, i) => loopNestedObj(divs));
            const modal = new bootstrap.Modal(document.querySelector('#modal'), {});

            document.onreadystatechange = () => modal.show();

            let current = 0;

            // ì‚¬ìš©ìê°€ ì„ íƒí•œ ê°’ë“¤
            const selected = [];

            // ì§ˆë¬¸ ê°ì²´
            class Question {
                message;
                options;
                short_title;
                constructor(short_title, message, options) {
                    this.short_title = short_title;
                    this.message = message;
                    this.options = options;
                }
            }

            //ì§ˆë¬¸ë“¤
            const questions = [
                new Question('ê°€) í‡´ì§ì‚¬ìœ ', 'ê°€) ê³ ê°ë‹˜ì˜ í‡´ì§ì‚¬ìœ ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”', [{ text: 'ëª…ì˜ˆí‡´ì§' }, { text: 'ì •ë…„í‡´ì§' }]),
                new Question('ë‚˜) ì¬ì§ê¸°ê°„', 'ë‚˜) ê³ ê°ë‹˜ì˜ ì¬ì§ê¸°ê°„ì€ ëª‡ë…„ ì´ì‹ ê°€ìš”?(í•©ì‚°, ì‚¬ë³‘ ê¸°ê°„ë“± ê°€ì‚°ê¸°ê°„ í¬í•¨)', [{ text: '10ë…„ì´ìƒ' }]),
                new Question('ë‹¤) ê¸‰ì—¬ì²­êµ¬ ì—¬ë¶€', 'ë‹¤) ê¸‰ì—¬ë¥¼ ì²­êµ¬ í•˜ì‹¤ ê±´ê°€ìš”?', [{ text: 'ë„¤' }, { text: 'ì•„ë‹ˆì˜¤' }]),
                new Question('ë¼) í‡´ì§ê¸‰ì—¬ ì¢…ë¥˜', 'ë¼) í‡´ì§ ê¸‰ì—¬ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”?', [{ text: 'ë¯¸ì •' }, { text: 'í‡´ì§ì—°ê¸ˆ' }, { text: 'í‡´ì§ì—°ê¸ˆì¼ì‹œê¸ˆ' }, { text: 'í‡´ì§ì—°ê¸ˆ ê³µì œì¼ì‹œê¸ˆ' }]),
                new Question('ë§ˆ) í‡´ì§ìˆ˜ë‹¹ ì²­êµ¬ì—¬ë¶€', 'ë§ˆ) í‡´ì§ìˆ˜ë‹¹ì„ ì²­êµ¬ í•˜ì‹¤ ê±´ê°€ìš”?', [{ text: 'ì²­êµ¬' }, { text: 'ë¯¸ì²­êµ¬' }]),
            ];

            // ì±„íŒ… ì‹œì‘
            const chatStart = () => {
                document.getElementById('messages').innerHTML = '';

                current = 0;

                const _div = document.createElement('div');
                //_div.classList.add(classname);
                _div.classList.add('pb-4', 'text-center');
                document.getElementById('messages').appendChild(_div);
                const _span = document.createElement('span');

                _span.textContent = moment().locale('ko').format('YYYY MMMM Do a h:mm');
                _div.appendChild(_span);
                _div.appendChild(document.createElement('hr'));

                chat({ message: 'ê³µì ì—°ê¸ˆ ì¢…í•©ì•ˆë‚´ë¥¼ ìœ„í•´<br>ê³ ê°ë‹˜ì˜ í˜„ì¬ ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”' });

                chat(questions[current]);
            };

            // ë©”ì„¸ì§€ ì°½ ìƒì„±
            const messagediv = (question) => {
                const { message, options } = question;

                const third = document.createElement('div');
                const thirdClasses = ['flex-shrink-1', 'bg-light', 'rounded', 'py-2', 'px-3'];
                third.classList.add(...thirdClasses);

                const msgDiv = document.createElement('div');
                msgDiv.classList.add('font-weight-bold', 'mb-1');
                msgDiv.innerHTML = message.replaceAll('\n', '<br>');

                third.appendChild(msgDiv);

                if (options) {
                    options.forEach((o, index) => {
                        const option = document.createElement('div');
                        option.classList.add('rounded', 'bg-secondary', 'bg-opacity-10', 'p-3', 'mt-1', 'pointer');
                        option.name = 'option' + current;

                        const optionTxt = `${index + 1}. ${o.text}`;
                        option.onclick = (e) => {
                            selected[current] = o.text;
                            answer(optionTxt);
                            e.target.classList.add('bg-opacity-25');

                            // ëŒ€ë‹µí•œ ì§ˆë¬¸ì— ë˜ ëŒ€ë‹µí• ìˆ˜ ì—†ë„ë¡ click ì´ë²¤íŠ¸ íšŒìˆ˜
                            const sibling = e.target.parentElement.children;

                            console.log(sibling);

                            for (let el of sibling) {
                                el.onclick = undefined;
                                el.classList.remove('pointer');
                            }
                            nextQuestion();
                        };
                        option.textContent = optionTxt;
                        third.appendChild(option);
                    });
                }

                return third;
            };

            // ì•„ë°”íƒ€ ë³´ì—¬ì¤Œ
            const avatar = () => {
                const second = document.createElement('div');
                second.classList.add('mx-2');

                const avatar = document.createElement('img');
                avatar.src = 'assets/img/users/geps.gif';
                avatar.classList.add('rounded-circle', 'me-1');
                avatar.width = 40;
                avatar.height = 40;
                avatar.alt = 'ë¯¿ìŒì´';

                second.appendChild(avatar);
                return second;
            };

            // ì±„íŒ…ì‹œê°„ ë³´ì—¬ì¤Œ
            const timediv = (classname) => {
                const fourth = document.createElement('div');
                fourth.classList.add('ms-2');

                const timeDiv = document.createElement('div');
                timeDiv.classList.add('text-muted', 'small', 'text-nowrap', 'mt-2');
                timeDiv.textContent = moment().locale('ko').format('a h:mm');
                timeDiv.classList.add(classname);

                fourth.appendChild(timeDiv);
                return fourth;
            };

            // ì±„íŒ…ì°½ ìƒì„±
            const chat = (question) => {
                const first = document.createElement('div');
                first.classList.add('other', 'pb-4');
                document.getElementById('messages').appendChild(first);

                // ì•„ë°”íƒ€
                first.appendChild(avatar());

                // ë©”ì„¸ì§€
                const messageDiv = messagediv(question);
                messageDiv.classList.add('message-friend');
                first.appendChild(messageDiv);

                //ì‹œê°„
                first.appendChild(timediv('ms-2'));

                first.focus();
            };

            // ì§ˆë¬¸ í–ˆì„ë•Œ ëŒ€ë‹µ
            const answer = (message) => {
                const first = document.createElement('div');
                first.classList.add('own', 'pb-4');
                document.getElementById('messages').appendChild(first);

                // ë©”ì„¸ì§€
                const messageDiv = messagediv({ message });
                messageDiv.classList.add('message');
                first.appendChild(messageDiv);

                //ì‹œê°„
                first.appendChild(timediv('me-2'));
            };

            // ê²°ê³¼ ë³´ì—¬ì£¼ëŠ” ì±„íŒ…
            const infoMessage = (info) => {
                const first = document.createElement('div');
                first.classList.add('other', 'pb-4');
                document.getElementById('messages').appendChild(first);

                // 1ì°¨ ì•ˆë‚´

                const messageDiv = document.createElement('div');
                const thirdClasses = ['flex-shrink-1', 'bg-light', 'rounded', 'py-2', 'px-3'];
                messageDiv.classList.add(...thirdClasses);

                const card = document.createElement('div');
                card.classList.add('card', 'bg-light', 'border-0', 'mb-2');
                card.style.minHeight = '10vh';

                const cardHeader = document.createElement('div');
                cardHeader.classList.add('card-header', 'bg-info', 'fs-5', 'mt-3');
                cardHeader.textContent = 'ğŸ ê³ ê°ë‹˜ì˜ ì˜ˆìƒë˜ëŠ” ë¯¸ë˜ ìƒí™©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.';

                card.appendChild(cardHeader);

                const divRow = document.createElement('div');
                divRow.classList.add('row');

                const divCol4 = document.createElement('div');
                divCol4.classList.add('col-4', 'align-bottom');

                //ë§ˆìŠ¤ì½”íŠ¸
                const mascot = document.createElement('img');
                mascot.src = 'assets/img/geps_mascot.png';
                mascot.alt = 'ë¯¿ìŒì´ì™€ ë™í–‰ì´';
                mascot.classList.add('card-img');

                divCol4.appendChild(mascot);
                divRow.appendChild(divCol4);

                const cardBody = document.createElement('div');
                cardBody.classList.add('card-body');

                const cardText = document.createElement('p');
                cardText.classList.add('card-text', 'font-weight-bold', 'mb-1', 'align-middle');
                cardText.innerHTML = info.message;

                cardBody.appendChild(cardText);

                const divCol8 = document.createElement('div');
                divCol8.classList.add('col-8');
                divCol8.appendChild(cardBody);

                divRow.appendChild(divCol8);
                card.appendChild(divRow);
                messageDiv.appendChild(card);

                const p2 = document.createElement('h5');
                p2.textContent = 'ğŸ’° ì†Œë“í™œë™ì—¬ë¶€';
                messageDiv.appendChild(p2);

                const card2 = infoMessage2(info);

                messageDiv.appendChild(card2);

                messageDiv.classList.add('message-friend');
                first.appendChild(messageDiv);

                infoMessage2(info);
            };

            // ê²°ê³¼ 2ì°½
            const infoMessage2 = (info) => {
                const card = document.createElement('div');
                card.classList.add('card', 'bg-light');
                card.style.minHeight = '10vh';

                const cardHeader = document.createElement('div');
                cardHeader.classList.add('card-header');

                const ul = document.createElement('ul');
                ul.classList.add('nav', 'nav-tabs', 'card-header-tabs');
                ul.role = 'tablist';

                const navTitles = ['ê³µë¬´ì›', 'ë¯¼ê°„', 'í•´ë‹¹ì—†ìŒ'];

                navTitles.forEach((navTitle, i) => {
                    const _li = document.createElement('li');
                    _li.classList.add('nav-item');
                    _li.role = 'presentation';
                    const a = document.createElement('a');
                    a.classList.add('nav-link');
                    if (i === 0) a.classList.add('active');
                    a.href = '#';
                    a.role = 'tab';
                    a.type = 'button';
                    a.dataset['bsToggle'] = 'tab';
                    a.dataset['bsTarget'] = `#info2_${i + 1}`;

                    a.textContent = navTitle;
                    _li.appendChild(a);
                    ul.appendChild(_li);
                });

                cardHeader.appendChild(ul);
                card.appendChild(cardHeader);

                const cardBody = document.createElement('div');
                cardBody.classList.add('card-body');

                const tabContent = document.createElement('div');
                tabContent.classList.add('tab-content');
                tabContent.id = 'nav-tabContent';

                const lis = [info.info2_1, info.info2_2, info.info2_3];

                lis.forEach((_li, i) => {
                    const _div = document.createElement('div');
                    _div.classList.add('tab-pane', 'fade');
                    if (i === 0) _div.classList.add('show', 'active');
                    _div.id = 'info2_' + (i + 1);
                    _div.rold = 'tabpanel';
                    _div.innerHTML = _li ? _li.replaceAll('\n', '<br>') : '-';
                    tabContent.appendChild(_div);
                });

                cardBody.appendChild(tabContent);

                // ë²„íŠ¼
                const button = document.createElement('a');
                button.href = '#';
                button.classList.add('btn', 'btn-md', 'btn-primary', 'mt-2', 'w-25');
                button.textContent = 'ì²˜ìŒë¶€í„°';
                button.onclick = chatStart;

                cardBody.appendChild(button);

                card.appendChild(cardBody);

                return card;
            };

            // ì§ˆë¬¸ì´ ëë‚˜ê³  ë‹¤ìŒ ì§ˆë¬¸
            const nextQuestion = () => {
                current++;
                if (current !== 5) {
                    chat(questions[current]);
                }

                if (current === 5) {
                    let mySelect = '';
                    selected.forEach((e, i) => (mySelect += `<b>${questions[i].short_title}</b><br>&nbsp;&nbsp;ğŸ‘‰ ${e}<br>`));

                    const info1_selected = info1.find((e) => e.selected.join('') === selected.join(''));

                    chat({ message: mySelect });
                    infoMessage(info1_selected);
                }

                const container = document.querySelector('main .container');
                container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
            };
            chatStart();
        </script>
    </body>
</html>
